{"version":3,"names":["React","require","react_utilities_1","react_context_selector_1","dropdownKeyActions_1","useOptionCollection_1","useScrollOptionsIntoView_1","useSelection_1","ComboboxContext_1","useListbox_unstable","props","ref","multiselect","optionCollection","useOptionCollection","getCount","getOptionAtIndex","getIndexOfId","clearSelection","selectedOptions","selectOption","useSelection","activeOption","setActiveOption","useState","focusVisible","setFocusVisible","onKeyDown","event","action","getDropdownActionFromKey","open","maxIndex","activeIndex","id","newIndex","getIndexFromAction","preventDefault","onMouseOver","hasComboboxContext","useHasParentContext","ComboboxContext","comboboxActiveOption","useContextSelector","ctx","comboboxFocusVisible","comboboxSelectedOptions","comboboxSelectOption","comboboxSetActiveOption","optionContextValues","state","components","root","getNativeElementProps","role","undefined","tabIndex","scrollContainerRef","useScrollOptionsIntoView","useMergedRefs","useEventCallback","mergeCallbacks","exports"],"sources":["../src/packages/react-components/react-combobox/src/components/Listbox/useListbox.ts"],"sourcesContent":["import * as React from 'react';\nimport { getNativeElementProps, mergeCallbacks, useEventCallback, useMergedRefs } from '@fluentui/react-utilities';\nimport { useContextSelector, useHasParentContext } from '@fluentui/react-context-selector';\nimport { getDropdownActionFromKey, getIndexFromAction } from '../../utils/dropdownKeyActions';\nimport type { OptionValue } from '../../utils/OptionCollection.types';\nimport { useOptionCollection } from '../../utils/useOptionCollection';\nimport { useScrollOptionsIntoView } from '../../utils/useScrollOptionsIntoView';\nimport { useSelection } from '../../utils/useSelection';\nimport { ComboboxContext } from '../../contexts/ComboboxContext';\nimport type { ListboxProps, ListboxState } from './Listbox.types';\n\n/**\n * Create the state required to render Listbox.\n *\n * The returned state can be modified with hooks such as useListboxStyles_unstable,\n * before being passed to renderListbox_unstable.\n *\n * @param props - props from this instance of Listbox\n * @param ref - reference to root HTMLElement of Listbox\n */\nexport const useListbox_unstable = (props: ListboxProps, ref: React.Ref<HTMLElement>): ListboxState => {\n  const { multiselect } = props;\n  const optionCollection = useOptionCollection();\n  const { getCount, getOptionAtIndex, getIndexOfId } = optionCollection;\n\n  const { clearSelection, selectedOptions, selectOption } = useSelection(props);\n\n  const [activeOption, setActiveOption] = React.useState<OptionValue | undefined>();\n\n  // track whether keyboard focus outline should be shown\n  // tabster/keyborg doesn't work here, since the actual keyboard focus target doesn't move\n  const [focusVisible, setFocusVisible] = React.useState(false);\n\n  const onKeyDown = (event: React.KeyboardEvent<HTMLElement>) => {\n    const action = getDropdownActionFromKey(event, { open: true });\n    const maxIndex = getCount() - 1;\n    const activeIndex = activeOption ? getIndexOfId(activeOption.id) : -1;\n    let newIndex = activeIndex;\n\n    switch (action) {\n      case 'Select':\n      case 'CloseSelect':\n        activeOption && selectOption(event, activeOption);\n        break;\n      default:\n        newIndex = getIndexFromAction(action, activeIndex, maxIndex);\n    }\n\n    if (newIndex !== activeIndex) {\n      // prevent default page scroll/keyboard action if the index changed\n      event.preventDefault();\n      setActiveOption(getOptionAtIndex(newIndex));\n      setFocusVisible(true);\n    }\n  };\n\n  const onMouseOver = (event: React.MouseEvent<HTMLElement>) => {\n    setFocusVisible(false);\n  };\n\n  // get state from parent combobox, if it exists\n  const hasComboboxContext = useHasParentContext(ComboboxContext);\n  const comboboxActiveOption = useContextSelector(ComboboxContext, ctx => ctx.activeOption);\n  const comboboxFocusVisible = useContextSelector(ComboboxContext, ctx => ctx.focusVisible);\n  const comboboxSelectedOptions = useContextSelector(ComboboxContext, ctx => ctx.selectedOptions);\n  const comboboxSelectOption = useContextSelector(ComboboxContext, ctx => ctx.selectOption);\n  const comboboxSetActiveOption = useContextSelector(ComboboxContext, ctx => ctx.setActiveOption);\n\n  // without a parent combobox context, provide values directly from Listbox\n  const optionContextValues = hasComboboxContext\n    ? {\n        activeOption: comboboxActiveOption,\n        focusVisible: comboboxFocusVisible,\n        selectedOptions: comboboxSelectedOptions,\n        selectOption: comboboxSelectOption,\n        setActiveOption: comboboxSetActiveOption,\n      }\n    : {\n        activeOption,\n        focusVisible,\n        selectedOptions,\n        selectOption,\n        setActiveOption,\n      };\n\n  const state: ListboxState = {\n    components: {\n      root: 'div',\n    },\n    root: getNativeElementProps('div', {\n      ref,\n      role: multiselect ? 'menu' : 'listbox',\n      'aria-activedescendant': hasComboboxContext ? undefined : activeOption?.id,\n      'aria-multiselectable': multiselect,\n      tabIndex: 0,\n      ...props,\n    }),\n    multiselect,\n    clearSelection,\n    ...optionCollection,\n    ...optionContextValues,\n  };\n\n  const scrollContainerRef = useScrollOptionsIntoView(state);\n  state.root.ref = useMergedRefs(state.root.ref, scrollContainerRef);\n\n  state.root.onKeyDown = useEventCallback(mergeCallbacks(state.root.onKeyDown, onKeyDown));\n  state.root.onMouseOver = useEventCallback(mergeCallbacks(state.root.onMouseOver, onMouseOver));\n\n  return state;\n};\n"],"mappings":"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"}