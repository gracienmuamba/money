{"version":3,"names":["React","require","react_utilities_1","react_context_selector_1","react_icons_1","ComboboxContext_1","ListboxContext_1","getTextString","text","children","undefined","textString","hasNonStringChild","Children","forEach","child","console","warn","useOption_unstable","props","ref","disabled","value","optionRef","useRef","optionText","optionValue","id","useId","optionData","useMemo","focusVisible","useContextSelector","ListboxContext","ctx","multiselect","registerOption","selected","selectedOptions","find","o","selectOption","setActiveOption","setOpen","ComboboxContext","active","_a","activeOption","_b","CheckIcon","createElement","CheckmarkFilled","Checkmark12Filled","onClick","event","preventDefault","call","useEffect","current","semanticProps","role","components","root","checkIcon","getNativeElementProps","useMergedRefs","resolveShorthand","required","defaultProps","exports"],"sources":["../src/packages/react-components/react-combobox/src/components/Option/useOption.tsx"],"sourcesContent":["import * as React from 'react';\nimport { getNativeElementProps, resolveShorthand, useId, useMergedRefs } from '@fluentui/react-utilities';\nimport { useContextSelector } from '@fluentui/react-context-selector';\nimport { CheckmarkFilled, Checkmark12Filled } from '@fluentui/react-icons';\nimport { ComboboxContext } from '../../contexts/ComboboxContext';\nimport { ListboxContext } from '../../contexts/ListboxContext';\nimport type { OptionValue } from '../../utils/OptionCollection.types';\nimport type { OptionProps, OptionState } from './Option.types';\n\nfunction getTextString(text: string | undefined, children: React.ReactNode) {\n  if (text !== undefined) {\n    return text;\n  }\n\n  let textString = '';\n  let hasNonStringChild = false;\n  React.Children.forEach(children, child => {\n    if (typeof child === 'string') {\n      textString += child;\n    } else {\n      hasNonStringChild = true;\n    }\n  });\n\n  // warn if an Option has non-string children and no text prop\n  if (hasNonStringChild) {\n    // eslint-disable-next-line no-console\n    console.warn('Provide a `text` prop to Option components when they contain non-string children.');\n  }\n\n  return textString;\n}\n\n/**\n * Create the state required to render Option.\n *\n * The returned state can be modified with hooks such as useOptionStyles_unstable,\n * before being passed to renderOption_unstable.\n *\n * @param props - props from this instance of Option\n * @param ref - reference to root HTMLElement of Option\n */\nexport const useOption_unstable = (props: OptionProps, ref: React.Ref<HTMLElement>): OptionState => {\n  const { children, disabled, text, value } = props;\n  const optionRef = React.useRef<HTMLElement>(null);\n  const optionText = getTextString(text, children);\n  const optionValue = value ?? optionText;\n\n  // use the id if provided, otherwise use a generated id\n  const id = useId('fluent-option', props.id);\n\n  // data used for context registration & events\n  const optionData = React.useMemo<OptionValue>(\n    () => ({ id, disabled, text: optionText, value: optionValue }),\n    [id, disabled, optionText, optionValue],\n  );\n\n  // context values\n  const focusVisible = useContextSelector(ListboxContext, ctx => ctx.focusVisible);\n  const multiselect = useContextSelector(ListboxContext, ctx => ctx.multiselect);\n  const registerOption = useContextSelector(ListboxContext, ctx => ctx.registerOption);\n  const selected = useContextSelector(ListboxContext, ctx => {\n    const selectedOptions = ctx.selectedOptions;\n\n    return !!optionValue && !!selectedOptions.find(o => o === optionValue);\n  });\n  const selectOption = useContextSelector(ListboxContext, ctx => ctx.selectOption);\n  const setActiveOption = useContextSelector(ListboxContext, ctx => ctx.setActiveOption);\n  const setOpen = useContextSelector(ComboboxContext, ctx => ctx.setOpen);\n\n  // current active option?\n  const active = useContextSelector(ListboxContext, ctx => {\n    return ctx.activeOption?.id !== undefined && ctx.activeOption?.id === id;\n  });\n\n  // check icon\n  let CheckIcon: React.ReactNode = <CheckmarkFilled />;\n  if (multiselect) {\n    CheckIcon = selected ? <Checkmark12Filled /> : '';\n  }\n\n  const onClick = (event: React.MouseEvent<HTMLDivElement>) => {\n    if (disabled) {\n      event.preventDefault();\n      return;\n    }\n\n    // clicked option should always become active option\n    setActiveOption(optionData);\n\n    // close on option click for single-select options in a combobox\n    if (!multiselect) {\n      setOpen?.(event, false);\n    }\n\n    // handle selection change\n    selectOption(event, optionData);\n\n    props.onClick?.(event);\n  };\n\n  // register option data with context\n  React.useEffect(() => {\n    if (id && optionRef.current) {\n      return registerOption(optionData, optionRef.current);\n    }\n  }, [id, optionData, registerOption]);\n\n  const semanticProps = multiselect\n    ? { role: 'menuitemcheckbox', 'aria-checked': selected }\n    : { role: 'option', 'aria-selected': selected };\n\n  return {\n    components: {\n      root: 'div',\n      checkIcon: 'span',\n    },\n    root: getNativeElementProps('div', {\n      ref: useMergedRefs(ref, optionRef),\n      'aria-disabled': disabled ? 'true' : undefined,\n      id,\n      ...semanticProps,\n      ...props,\n      onClick,\n    }),\n    checkIcon: resolveShorthand(props.checkIcon, {\n      required: true,\n      defaultProps: {\n        'aria-hidden': 'true',\n        children: CheckIcon,\n      },\n    }),\n    active,\n    disabled,\n    focusVisible,\n    multiselect,\n    selected,\n  };\n};\n"],"mappings":"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"}