{"version":3,"names":["React","require","keyboard_keys_1","react_utilities_1","react_shared_contexts_1","STEP","PRECISION_MODIFIER","Shift","PRECISION_FACTOR","useKeyboardResizing","columnResizeState","columnId","useRef","onChangeRef","addListenerTimeout","columnResizeStateRef","useEffect","current","targetDocument","useFluent_unstable","keyboardHandler","useEventCallback","event","colId","width","getColumnWidth","precisionModifier","getModifierState","stopEvent","preventDefault","stopPropagation","key","ArrowLeft","setColumnWidth","ArrowRight","Space","Enter","Escape","disableInteractiveMode","_a","defaultView","clearTimeout","_b","removeEventListener","enableInteractiveMode","useCallback","call","setTimeout","addEventListener","undefined","toggleInteractiveMode","onChange","exports"],"sources":["../src/packages/react-components/react-table/src/hooks/useKeyboardResizing.ts"],"sourcesContent":["import * as React from 'react';\nimport { ArrowLeft, ArrowRight, Enter, Escape, Shift, Space } from '@fluentui/keyboard-keys';\nimport { useEventCallback } from '@fluentui/react-utilities';\nimport { ColumnResizeState, EnableKeyboardModeOnChangeCallback, TableColumnId } from './types';\nimport { useFluent_unstable as useFluent } from '@fluentui/react-shared-contexts';\n\nconst STEP = 20;\nconst PRECISION_MODIFIER = Shift;\nconst PRECISION_FACTOR = 1 / 4;\n\nexport function useKeyboardResizing(columnResizeState: ColumnResizeState) {\n  const columnId = React.useRef<TableColumnId>();\n  const onChangeRef = React.useRef<EnableKeyboardModeOnChangeCallback>();\n  const addListenerTimeout = React.useRef<number>();\n\n  const columnResizeStateRef = React.useRef<ColumnResizeState>(columnResizeState);\n  React.useEffect(() => {\n    columnResizeStateRef.current = columnResizeState;\n  }, [columnResizeState]);\n\n  const { targetDocument } = useFluent();\n\n  const keyboardHandler = useEventCallback((event: KeyboardEvent) => {\n    const colId = columnId.current;\n\n    if (!colId) {\n      return;\n    }\n\n    const width = columnResizeStateRef.current.getColumnWidth(colId);\n    const precisionModifier = event.getModifierState(PRECISION_MODIFIER);\n\n    const stopEvent = () => {\n      event.preventDefault();\n      event.stopPropagation();\n    };\n\n    switch (event.key) {\n      case ArrowLeft:\n        stopEvent();\n        columnResizeStateRef.current.setColumnWidth(event, {\n          columnId: colId,\n          width: width - (precisionModifier ? STEP * PRECISION_FACTOR : STEP),\n        });\n        return;\n\n      case ArrowRight:\n        stopEvent();\n        columnResizeStateRef.current.setColumnWidth(event, {\n          columnId: colId,\n          width: width + (precisionModifier ? STEP * PRECISION_FACTOR : STEP),\n        });\n        return;\n\n      case Space:\n      case Enter:\n      case Escape:\n        stopEvent();\n        disableInteractiveMode();\n        break;\n    }\n  });\n\n  // On component unmout, cancel any timer for adding a listener (if it exists) and remove the listener\n  React.useEffect(\n    () => () => {\n      targetDocument?.defaultView?.clearTimeout(addListenerTimeout.current);\n      targetDocument?.defaultView?.removeEventListener('keydown', keyboardHandler);\n    },\n    [keyboardHandler, targetDocument?.defaultView],\n  );\n\n  const enableInteractiveMode = React.useCallback(\n    (colId: TableColumnId) => {\n      columnId.current = colId;\n      onChangeRef.current?.(colId, true);\n      // Create the listener in the next tick, because the event that triggered this is still propagating\n      // when Enter was pressed and would be caught in the keyboardHandler, disabling the keyboard mode immediately.\n      // No idea why this is happening, but this is a working workaround.\n      // Tracked here: https://github.com/microsoft/fluentui/issues/27177\n      addListenerTimeout.current = targetDocument?.defaultView?.setTimeout(() => {\n        targetDocument?.defaultView?.addEventListener('keydown', keyboardHandler);\n      }, 0);\n    },\n    [keyboardHandler, targetDocument?.defaultView],\n  );\n\n  const disableInteractiveMode = React.useCallback(() => {\n    if (columnId.current) {\n      onChangeRef.current?.(columnId.current, false);\n    }\n    columnId.current = undefined;\n    targetDocument?.defaultView?.removeEventListener('keydown', keyboardHandler);\n  }, [keyboardHandler, targetDocument?.defaultView]);\n\n  const toggleInteractiveMode = (colId: TableColumnId, onChange?: EnableKeyboardModeOnChangeCallback) => {\n    onChangeRef.current = onChange;\n    if (!columnId.current) {\n      enableInteractiveMode(colId);\n    } else if (colId && columnId.current !== colId) {\n      columnId.current = colId;\n      onChange?.(columnId.current, true);\n    } else {\n      disableInteractiveMode();\n    }\n  };\n\n  return {\n    toggleInteractiveMode,\n  };\n}\n"],"mappings":"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"}