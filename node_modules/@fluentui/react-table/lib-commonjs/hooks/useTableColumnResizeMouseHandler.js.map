{"version":3,"names":["React","require","react_shared_contexts_1","react_utilities_1","useTableColumnResizeMouseHandler","columnResizeState","mouseX","useRef","currentWidth","colId","undefined","targetDocument","useFluent_unstable","globalWin","defaultView","recalculatePosition","useCallback","e","clientX","getEventClientCoords","dx","current","setColumnWidth","columnId","width","onDrag","requestAnimationFrame","onDragEnd","event","isMouseEvent","removeEventListener","isTouchEvent","getOnMouseDown","getColumnWidth","target","currentTarget","button","addEventListener","exports"],"sources":["../src/packages/react-components/react-table/src/hooks/useTableColumnResizeMouseHandler.ts"],"sourcesContent":["import * as React from 'react';\nimport { TableColumnId, ColumnResizeState } from './types';\nimport { useFluent_unstable as useFluent } from '@fluentui/react-shared-contexts';\nimport {\n  NativeTouchOrMouseEvent,\n  ReactTouchOrMouseEvent,\n  getEventClientCoords,\n  isMouseEvent,\n  isTouchEvent,\n} from '@fluentui/react-utilities';\n\nexport function useTableColumnResizeMouseHandler(columnResizeState: ColumnResizeState) {\n  const mouseX = React.useRef(0);\n  const currentWidth = React.useRef(0);\n  const colId = React.useRef<TableColumnId | undefined>(undefined);\n\n  const { targetDocument } = useFluent();\n  const globalWin = targetDocument?.defaultView;\n\n  const recalculatePosition = React.useCallback(\n    (e: NativeTouchOrMouseEvent) => {\n      const { clientX } = getEventClientCoords(e);\n      const dx = clientX - mouseX.current;\n\n      // Update the local width for the column and set it\n      currentWidth.current += dx;\n      colId.current && columnResizeState.setColumnWidth(e, { columnId: colId.current, width: currentWidth.current });\n      mouseX.current = clientX;\n    },\n    [columnResizeState],\n  );\n\n  const onDrag = React.useCallback(\n    (e: NativeTouchOrMouseEvent) => {\n      // Using requestAnimationFrame here drastically improves resizing experience on slower CPUs\n      if (typeof globalWin?.requestAnimationFrame === 'function') {\n        requestAnimationFrame(() => recalculatePosition(e));\n      } else {\n        recalculatePosition(e);\n      }\n    },\n    [globalWin?.requestAnimationFrame, recalculatePosition],\n  );\n\n  const onDragEnd = React.useCallback(\n    (event: NativeTouchOrMouseEvent) => {\n      if (isMouseEvent(event)) {\n        targetDocument?.removeEventListener('mouseup', onDragEnd);\n        targetDocument?.removeEventListener('mousemove', onDrag);\n      }\n      if (isTouchEvent(event)) {\n        targetDocument?.removeEventListener('touchend', onDragEnd);\n        targetDocument?.removeEventListener('touchmove', onDrag);\n      }\n    },\n    [onDrag, targetDocument],\n  );\n\n  const getOnMouseDown = (columnId: TableColumnId) => (event: ReactTouchOrMouseEvent) => {\n    // Keep the width locally so that we decouple the calculation of the next with from rendering.\n    // This makes the whole experience much faster and more precise\n    currentWidth.current = columnResizeState.getColumnWidth(columnId);\n    mouseX.current = getEventClientCoords(event).clientX;\n    colId.current = columnId;\n\n    if (isMouseEvent(event)) {\n      // ignore other buttons than primary mouse button\n      if (event.target !== event.currentTarget || event.button !== 0) {\n        return;\n      }\n      targetDocument?.addEventListener('mouseup', onDragEnd);\n      targetDocument?.addEventListener('mousemove', onDrag);\n    }\n\n    if (isTouchEvent(event)) {\n      targetDocument?.addEventListener('touchend', onDragEnd);\n      targetDocument?.addEventListener('touchmove', onDrag);\n    }\n  };\n\n  return {\n    getOnMouseDown: (columnId: TableColumnId) => getOnMouseDown(columnId),\n  };\n}\n"],"mappings":"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"}