{"version":3,"names":["React","ArrowLeft","ArrowRight","Enter","Escape","Shift","Space","useEventCallback","useFluent_unstable","useFluent","STEP","PRECISION_MODIFIER","PRECISION_FACTOR","useKeyboardResizing","columnResizeState","columnId","useRef","onChangeRef","addListenerTimeout","columnResizeStateRef","useEffect","current","targetDocument","keyboardHandler","event","colId","width","getColumnWidth","precisionModifier","getModifierState","stopEvent","preventDefault","stopPropagation","key","setColumnWidth","disableInteractiveMode","_a","defaultView","clearTimeout","_b","removeEventListener","enableInteractiveMode","useCallback","call","setTimeout","addEventListener","undefined","toggleInteractiveMode","onChange"],"sources":["../src/packages/react-components/react-table/src/hooks/useKeyboardResizing.ts"],"sourcesContent":["import * as React from 'react';\nimport { ArrowLeft, ArrowRight, Enter, Escape, Shift, Space } from '@fluentui/keyboard-keys';\nimport { useEventCallback } from '@fluentui/react-utilities';\nimport { ColumnResizeState, EnableKeyboardModeOnChangeCallback, TableColumnId } from './types';\nimport { useFluent_unstable as useFluent } from '@fluentui/react-shared-contexts';\n\nconst STEP = 20;\nconst PRECISION_MODIFIER = Shift;\nconst PRECISION_FACTOR = 1 / 4;\n\nexport function useKeyboardResizing(columnResizeState: ColumnResizeState) {\n  const columnId = React.useRef<TableColumnId>();\n  const onChangeRef = React.useRef<EnableKeyboardModeOnChangeCallback>();\n  const addListenerTimeout = React.useRef<number>();\n\n  const columnResizeStateRef = React.useRef<ColumnResizeState>(columnResizeState);\n  React.useEffect(() => {\n    columnResizeStateRef.current = columnResizeState;\n  }, [columnResizeState]);\n\n  const { targetDocument } = useFluent();\n\n  const keyboardHandler = useEventCallback((event: KeyboardEvent) => {\n    const colId = columnId.current;\n\n    if (!colId) {\n      return;\n    }\n\n    const width = columnResizeStateRef.current.getColumnWidth(colId);\n    const precisionModifier = event.getModifierState(PRECISION_MODIFIER);\n\n    const stopEvent = () => {\n      event.preventDefault();\n      event.stopPropagation();\n    };\n\n    switch (event.key) {\n      case ArrowLeft:\n        stopEvent();\n        columnResizeStateRef.current.setColumnWidth(event, {\n          columnId: colId,\n          width: width - (precisionModifier ? STEP * PRECISION_FACTOR : STEP),\n        });\n        return;\n\n      case ArrowRight:\n        stopEvent();\n        columnResizeStateRef.current.setColumnWidth(event, {\n          columnId: colId,\n          width: width + (precisionModifier ? STEP * PRECISION_FACTOR : STEP),\n        });\n        return;\n\n      case Space:\n      case Enter:\n      case Escape:\n        stopEvent();\n        disableInteractiveMode();\n        break;\n    }\n  });\n\n  // On component unmout, cancel any timer for adding a listener (if it exists) and remove the listener\n  React.useEffect(\n    () => () => {\n      targetDocument?.defaultView?.clearTimeout(addListenerTimeout.current);\n      targetDocument?.defaultView?.removeEventListener('keydown', keyboardHandler);\n    },\n    [keyboardHandler, targetDocument?.defaultView],\n  );\n\n  const enableInteractiveMode = React.useCallback(\n    (colId: TableColumnId) => {\n      columnId.current = colId;\n      onChangeRef.current?.(colId, true);\n      // Create the listener in the next tick, because the event that triggered this is still propagating\n      // when Enter was pressed and would be caught in the keyboardHandler, disabling the keyboard mode immediately.\n      // No idea why this is happening, but this is a working workaround.\n      // Tracked here: https://github.com/microsoft/fluentui/issues/27177\n      addListenerTimeout.current = targetDocument?.defaultView?.setTimeout(() => {\n        targetDocument?.defaultView?.addEventListener('keydown', keyboardHandler);\n      }, 0);\n    },\n    [keyboardHandler, targetDocument?.defaultView],\n  );\n\n  const disableInteractiveMode = React.useCallback(() => {\n    if (columnId.current) {\n      onChangeRef.current?.(columnId.current, false);\n    }\n    columnId.current = undefined;\n    targetDocument?.defaultView?.removeEventListener('keydown', keyboardHandler);\n  }, [keyboardHandler, targetDocument?.defaultView]);\n\n  const toggleInteractiveMode = (colId: TableColumnId, onChange?: EnableKeyboardModeOnChangeCallback) => {\n    onChangeRef.current = onChange;\n    if (!columnId.current) {\n      enableInteractiveMode(colId);\n    } else if (colId && columnId.current !== colId) {\n      columnId.current = colId;\n      onChange?.(columnId.current, true);\n    } else {\n      disableInteractiveMode();\n    }\n  };\n\n  return {\n    toggleInteractiveMode,\n  };\n}\n"],"mappings":"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"}