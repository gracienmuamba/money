{"version":3,"names":["React","require","useEventCallback_1","useOnClickOutside","options","refs","callback","element","disabled","contains","containsProp","timeoutId","useRef","undefined","useIFrameFocus","listener","useEventCallback","ev","parent","child","isOutside","every","ref","current","target","useEffect","currentEvent","getWindowEvent","window","conditionalHandler","event","addEventListener","setTimeout","removeEventListener","clearTimeout","exports","_c","_b","_a","ownerDocument","defaultView","FUI_FRAME_EVENT","targetDocument","pollDuration","timeoutRef","e","setInterval","activeElement","tagName","CustomEvent","bubbles","dispatchEvent"],"sources":["../src/packages/react-components/react-utilities/src/hooks/useOnClickOutside.ts"],"sourcesContent":["import * as React from 'react';\nimport { useEventCallback } from './useEventCallback';\n\n/**\n * @internal\n */\nexport type UseOnClickOrScrollOutsideOptions = {\n  /**\n   * The element to listen for the click event\n   */\n  element: Document | undefined;\n  /**\n   * Refs to elements that check if the click is outside\n   */\n  refs: React.MutableRefObject<HTMLElement | undefined | null>[];\n\n  /**\n   * By default uses element.contains, but custom contain function can be provided\n   * @param parentRef - provided parent ref\n   * @param child - event target element\n   */\n  contains?(parent: HTMLElement | null, child: HTMLElement): boolean;\n\n  /**\n   * Disables event listeners\n   */\n  disabled?: boolean;\n\n  /**\n   * Called if the click is outside the element refs\n   */\n  callback: (ev: MouseEvent | TouchEvent) => void;\n};\n\n/**\n * @internal\n * Utility to perform checks where a click/touch event was made outside a component\n */\nexport const useOnClickOutside = (options: UseOnClickOrScrollOutsideOptions) => {\n  const { refs, callback, element, disabled, contains: containsProp } = options;\n  const timeoutId = React.useRef<number | undefined>(undefined);\n  useIFrameFocus(options);\n\n  const listener = useEventCallback((ev: MouseEvent | TouchEvent) => {\n    const contains: UseOnClickOrScrollOutsideOptions['contains'] =\n      containsProp || ((parent, child) => !!parent?.contains(child));\n\n    const isOutside = refs.every(ref => !contains(ref.current || null, ev.target as HTMLElement));\n    if (isOutside && !disabled) {\n      callback(ev);\n    }\n  });\n\n  React.useEffect(() => {\n    // Store the current event to avoid triggering handlers immediately\n    // Note this depends on a deprecated but extremely well supported quirk of the web platform\n    // https://github.com/facebook/react/issues/20074\n    let currentEvent = getWindowEvent(window);\n\n    const conditionalHandler = (event: MouseEvent | TouchEvent) => {\n      // Skip if this event is the same as the one running when we added the handlers\n      if (event === currentEvent) {\n        currentEvent = undefined;\n        return;\n      }\n\n      listener(event);\n    };\n\n    if (!disabled) {\n      // use capture phase because React can update DOM before the event bubbles to the document\n      element?.addEventListener('click', conditionalHandler, true);\n      element?.addEventListener('touchstart', conditionalHandler, true);\n      element?.addEventListener('contextmenu', conditionalHandler, true);\n    }\n\n    // Garbage collect this event after it's no longer useful to avoid memory leaks\n    timeoutId.current = window.setTimeout(() => {\n      currentEvent = undefined;\n    }, 1);\n\n    return () => {\n      element?.removeEventListener('click', conditionalHandler, true);\n      element?.removeEventListener('touchstart', conditionalHandler, true);\n      element?.removeEventListener('contextmenu', conditionalHandler, true);\n\n      clearTimeout(timeoutId.current);\n      currentEvent = undefined;\n    };\n  }, [listener, element, disabled]);\n};\n\nconst getWindowEvent = (target: Node | Window): Event | undefined => {\n  if (target) {\n    if (typeof (target as Window).window === 'object' && (target as Window).window === target) {\n      // eslint-disable-next-line deprecation/deprecation\n      return target.event;\n    }\n\n    // eslint-disable-next-line deprecation/deprecation\n    return (target as Node).ownerDocument?.defaultView?.event ?? undefined;\n  }\n\n  return undefined;\n};\n\nconst FUI_FRAME_EVENT = 'fuiframefocus';\n\ninterface UseIFrameFocusOptions extends UseOnClickOrScrollOutsideOptions {\n  /**\n   * Millisecond duration to poll\n   */\n  pollDuration?: number;\n}\n\n/**\n * Since click events do not propagate past iframes, we use focus to detect if a\n * click has happened inside an iframe, since the only ways of focusing inside an\n * iframe are:\n *   - clicking inside\n *   - tabbing inside\n *\n * Polls the value of `document.activeElement`. If it is an iframe, then dispatch\n * a custom DOM event. When the custom event is received call the provided callback\n */\nconst useIFrameFocus = (options: UseIFrameFocusOptions) => {\n  const {\n    disabled,\n    element: targetDocument,\n    callback,\n    contains: containsProp = (parent, child) => !!parent?.contains(child),\n    pollDuration = 1000,\n    refs,\n  } = options;\n  const timeoutRef = React.useRef<number>();\n\n  const listener = useEventCallback((e: Event) => {\n    const contains = containsProp || ((parent, child) => !!parent?.contains(child));\n\n    const isOutside = refs.every(ref => !contains(ref.current || null, e.target as HTMLElement));\n    if (isOutside && !disabled) {\n      callback(e as MouseEvent);\n    }\n  });\n\n  // Adds listener to the custom iframe focus event\n  React.useEffect(() => {\n    if (!disabled) {\n      targetDocument?.addEventListener(FUI_FRAME_EVENT, listener, true);\n      return () => {\n        targetDocument?.removeEventListener(FUI_FRAME_EVENT, listener, true);\n      };\n    }\n  }, [targetDocument, disabled, listener]);\n\n  // Starts polling for the active element\n  React.useEffect(() => {\n    if (!disabled) {\n      timeoutRef.current = targetDocument?.defaultView?.setInterval(() => {\n        const activeElement = targetDocument?.activeElement;\n        if (activeElement?.tagName === 'IFRAME' || activeElement?.tagName === 'WEBVIEW') {\n          const event = new CustomEvent(FUI_FRAME_EVENT, { bubbles: true });\n          activeElement.dispatchEvent(event);\n        }\n      }, pollDuration);\n    }\n    return () => {\n      targetDocument?.defaultView?.clearTimeout(timeoutRef.current);\n    };\n  }, [targetDocument, disabled, pollDuration]);\n};\n"],"mappings":"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"}