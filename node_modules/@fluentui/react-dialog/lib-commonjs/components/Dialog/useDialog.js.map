{"version":3,"names":["React","require","react_utilities_1","react_context_selector_1","utils_1","contexts_1","useDialog_unstable","props","children","modalType","onOpenChange","inertTrapFocus","trigger","content","childrenToTriggerAndContent","open","setOpen","useControllableState","state","defaultState","defaultOpen","initialState","requestOpenChange","useEventCallback","data","event","isDefaultPrevented","focusRef","useFocusFirstElement","disableBodyScroll","useDisableBodyScroll","isBodyScrollLocked","Boolean","useIsomorphicLayoutEffect","components","backdrop","dialogTitleId","useId","isNestedDialog","useHasParentContext","DialogContext","dialogRef","exports","childrenArray","Children","toArray","process","env","NODE_ENV","length","console","warn","undefined"],"sources":["../src/packages/react-components/react-dialog/src/components/Dialog/useDialog.ts"],"sourcesContent":["import * as React from 'react';\nimport { useControllableState, useEventCallback, useId, useIsomorphicLayoutEffect } from '@fluentui/react-utilities';\nimport { useHasParentContext } from '@fluentui/react-context-selector';\nimport { useDisableBodyScroll, useFocusFirstElement } from '../../utils';\nimport { DialogContext } from '../../contexts';\n\nimport type { DialogOpenChangeData, DialogProps, DialogState } from './Dialog.types';\n\n/**\n * Create the state required to render Dialog.\n *\n * The returned state can be modified with hooks such as useDialogStyles_unstable,\n * before being passed to renderDialog_unstable.\n *\n * @param props - props from this instance of Dialog\n */\nexport const useDialog_unstable = (props: DialogProps): DialogState => {\n  const { children, modalType = 'modal', onOpenChange, inertTrapFocus = false } = props;\n\n  const [trigger, content] = childrenToTriggerAndContent(children);\n\n  const [open, setOpen] = useControllableState({\n    state: props.open,\n    defaultState: props.defaultOpen,\n    initialState: false,\n  });\n\n  const requestOpenChange = useEventCallback((data: DialogOpenChangeData) => {\n    onOpenChange?.(data.event, data);\n\n    // if user prevents default then do not change state value\n    // otherwise updates state value and trigger reference to the element that caused the opening\n    if (!data.event.isDefaultPrevented()) {\n      setOpen(data.open);\n    }\n  });\n\n  const focusRef = useFocusFirstElement(open, modalType);\n  const disableBodyScroll = useDisableBodyScroll();\n  const isBodyScrollLocked = Boolean(open && modalType !== 'non-modal');\n\n  useIsomorphicLayoutEffect(() => {\n    if (isBodyScrollLocked) {\n      return disableBodyScroll();\n    }\n  }, [disableBodyScroll, isBodyScrollLocked]);\n\n  return {\n    components: {\n      backdrop: 'div',\n    },\n    inertTrapFocus,\n    open,\n    modalType,\n    content: open ? content : null,\n    trigger,\n    requestOpenChange,\n    dialogTitleId: useId('dialog-title-'),\n    isNestedDialog: useHasParentContext(DialogContext),\n    dialogRef: focusRef,\n  };\n};\n\n/**\n * Extracts trigger and content from children\n */\nfunction childrenToTriggerAndContent(\n  children: React.ReactNode,\n): readonly [trigger: React.ReactNode, content: React.ReactNode] {\n  const childrenArray = React.Children.toArray(children) as React.ReactElement[];\n  if (process.env.NODE_ENV !== 'production') {\n    if (childrenArray.length !== 1 && childrenArray.length !== 2) {\n      // eslint-disable-next-line no-console\n      console.warn(\n        'Dialog must contain at least one child <DialogSurface/>,\\n' +\n          'and at most two children <DialogTrigger/> <DialogSurface/> (in this order)',\n      );\n    }\n  }\n  switch (childrenArray.length) {\n    // case where there's a trigger followed by content\n    case 2:\n      return childrenArray as [trigger: React.ReactNode, content: React.ReactNode];\n    // case where there's only content\n    case 1:\n      return [undefined, childrenArray[0]];\n    // unknown case\n    default:\n      return [undefined, undefined];\n  }\n}\n"],"mappings":";;;;;;AAAA,MAAAA,KAAA,gBAAAC,OAAA;AACA,MAAAC,iBAAA,gBAAAD,OAAA;AACA,MAAAE,wBAAA,gBAAAF,OAAA;AACA,MAAAG,OAAA,gBAAAH,OAAA;AACA,MAAAI,UAAA,gBAAAJ,OAAA;AAIA;;;;;;;;AAQO,MAAMK,kBAAkB,GAAIC,KAAkB,IAAiB;EACpE,MAAM;IAAEC,QAAQ;IAAEC,SAAS,GAAG,OAAO;IAAEC,YAAY;IAAEC,cAAc,GAAG;EAAK,CAAE,GAAGJ,KAAK;EAErF,MAAM,CAACK,OAAO,EAAEC,OAAO,CAAC,GAAGC,2BAA2B,CAACN,QAAQ,CAAC;EAEhE,MAAM,CAACO,IAAI,EAAEC,OAAO,CAAC,GAAGd,iBAAA,CAAAe,oBAAoB,CAAC;IAC3CC,KAAK,EAAEX,KAAK,CAACQ,IAAI;IACjBI,YAAY,EAAEZ,KAAK,CAACa,WAAW;IAC/BC,YAAY,EAAE;GACf,CAAC;EAEF,MAAMC,iBAAiB,GAAGpB,iBAAA,CAAAqB,gBAAgB,CAAEC,IAA0B,IAAI;IACxEd,YAAY,aAAZA,YAAY,uBAAZA,YAAY,CAAGc,IAAI,CAACC,KAAK,EAAED,IAAI,CAAC;IAEhC;IACA;IACA,IAAI,CAACA,IAAI,CAACC,KAAK,CAACC,kBAAkB,EAAE,EAAE;MACpCV,OAAO,CAACQ,IAAI,CAACT,IAAI,CAAC;;EAEtB,CAAC,CAAC;EAEF,MAAMY,QAAQ,GAAGvB,OAAA,CAAAwB,oBAAoB,CAACb,IAAI,EAAEN,SAAS,CAAC;EACtD,MAAMoB,iBAAiB,GAAGzB,OAAA,CAAA0B,oBAAoB,EAAE;EAChD,MAAMC,kBAAkB,GAAGC,OAAO,CAACjB,IAAI,IAAIN,SAAS,KAAK,WAAW,CAAC;EAErEP,iBAAA,CAAA+B,yBAAyB,CAAC,MAAK;IAC7B,IAAIF,kBAAkB,EAAE;MACtB,OAAOF,iBAAiB,EAAE;;EAE9B,CAAC,EAAE,CAACA,iBAAiB,EAAEE,kBAAkB,CAAC,CAAC;EAE3C,OAAO;IACLG,UAAU,EAAE;MACVC,QAAQ,EAAE;KACX;IACDxB,cAAc;IACdI,IAAI;IACJN,SAAS;IACTI,OAAO,EAAEE,IAAI,GAAGF,OAAO,GAAG,IAAI;IAC9BD,OAAO;IACPU,iBAAiB;IACjBc,aAAa,EAAElC,iBAAA,CAAAmC,KAAK,CAAC,eAAe,CAAC;IACrCC,cAAc,EAAEnC,wBAAA,CAAAoC,mBAAmB,CAAClC,UAAA,CAAAmC,aAAa,CAAC;IAClDC,SAAS,EAAEd;GACZ;AACH,CAAC;AA7CYe,OAAA,CAAApC,kBAAkB,GAAAA,kBAAA;AA+C/B;;;AAGA,SAASQ,2BAA2BA,CAClCN,QAAyB;EAEzB,MAAMmC,aAAa,GAAG3C,KAAK,CAAC4C,QAAQ,CAACC,OAAO,CAACrC,QAAQ,CAAyB;EAC9E,IAAIsC,OAAO,CAACC,GAAG,CAACC,QAAQ,KAAK,YAAY,EAAE;IACzC,IAAIL,aAAa,CAACM,MAAM,KAAK,CAAC,IAAIN,aAAa,CAACM,MAAM,KAAK,CAAC,EAAE;MAC5D;MACAC,OAAO,CAACC,IAAI,CACV,4DAA4D,GAC1D,4EAA4E,CAC/E;;;EAGL,QAAQR,aAAa,CAACM,MAAM;IAC1B;IACA,KAAK,CAAC;MACJ,OAAON,aAAqE;IAC9E;IACA,KAAK,CAAC;MACJ,OAAO,CAACS,SAAS,EAAET,aAAa,CAAC,CAAC,CAAC,CAAC;IACtC;IACA;MACE,OAAO,CAACS,SAAS,EAAEA,SAAS,CAAC;EAAC;AAEpC"}